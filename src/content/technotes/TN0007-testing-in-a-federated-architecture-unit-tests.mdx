---
title: Testing in a Federated Architecture
tags: [server, router, testing]
---

Testing in a federated architecture has three general parts: unit testing, integration testing and compisition testing.

## Unit testing

We recommend unit testing all your resolvers. When unit testing your resolvers we recommend mocking as much of the data as possible using something like [`@faker-js/faker`](https://www.npmjs.com/package/@faker-js/faker). This package allows you to use realistic fake data when mocking inputs and outputs.

### `__resolveReference`

A [`__resolveReference`](https://www.apollographql.com/docs/federation/entities/#2-define-a-reference-resolver) warrents a spesfic call out in a federated architecture. A `__resolveReference` is how subgraphs comunicate, making testing this code very important.

## Integration testing

When doing integration tests please consider the following:

- Operations should be pulled from current live quries
  - The best way to look at the operations that are currently going though your graph and useing thouse operations for testing.
  - Current queries can be pulled from Apollo studio's API.
- Random test quries/mutations should be avoided
  - Random tests end up testing paths that are not relistic. We suggest pulling the quries from studio insted of using random queries.
- Cardinailty should be concidered
  - When running tests, spesfically intergrations test, low cardinailty tests end up hitting caches. The best way to avoid caches is have a high cardinailty in the variables used. One of the ways we recommend to help midigate the problem is using as many query/mutation variables as possible. This allows for easy changeing of inputs.

### `__resolveReference` and integrations testing subgraphs

In a subgraph, you may not start from the query node depending on your schema. The integration tests in this situation involves mimicing what the gateway/router. You can execute a query against `_entities` to do integration tests. This looks like the following:

```js
const query = `query GetEntities($representations: [_Any!]!) {
  _entities(representations: $representations) {
   ... on User {
     firstName
   }
  }
}`;
```

## Compisition testing

Compisiton testing is spesfic to federated architectures. It involves testing that your graph will compose and handle the queries that are currently sent to it by clients. This is handled though [rover](https://www.apollographql.com/docs/rover/). These checks are done by running the [`rover subgraph check`](https://www.apollographql.com/docs/rover/commands/subgraphs#checking-subgraph-schema-changes) command. This is best place in your CI/CD pipeline.
