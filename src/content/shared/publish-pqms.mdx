<blockquote>

Ensure your Rover CLI version is `0.17.2` or later. Previous versions of Rover don't support publishing operations to a PQL.
[Download the latest version.](/rover/getting-started/)

</blockquote>

After you [generate an operation manifest](/graphos/operations/persisted-queries#31-generate-persisted-queries-manifests), you publish it to your PQL with the [Rover CLI](/rover/) like so:

```bash title="Example command"
rover persisted-queries publish my-graph@my-variant \
  --manifest ./persisted-query-manifest.json
```

- The `my-graph@my-variant` argument is the [`graph ref`](/rover/conventions#graph-refs) of _any_ variant the PQL is [linked to](/graphos/operations/persisted-queries#12-link-the-pql-to-variants).
  - Graph refs have the format `graph-id@variant-name`.
- Use the `--manifest` option to provide the path to the manifest you want to publish.

> The `persisted-queries publish` command assumes manifests are in the [format](/graphos/operations/persisted-queries#manifest-format) generated by Apollo client tools. The command can also support manifests [generated by the Relay compiler](https://relay.dev/docs/guides/persisted-queries/#local-persisted-queries) by adding the [`--manifest-format relay`](/rover/commands/persisted-queries/#relay-support) argument.

**The `persisted-queries publish` command does the following:**

1. Publishes all operations in the provided manifest file to the PQL linked to the specified variant, or to the specified PQL.

   - Publishing a manifest to a PQL is additive. Any _existing_ entries in the PQL remain.
   - If you publish an operation with the same `id` but different details from an existing entry in the PQL, the entire publish command fails with an error.

2. Updates any _other_ variants that the PQL is applied to so that routers associated with those variants can fetch their updated PQL.

As with [generating manifests](/graphos/operations/persisted-queries#31-generate-persisted-queries-manifests), it's best to execute this command in your CI/CD pipeline to publish new operations as part of your app release process. The API key you supply to Rover must have the [role](/graphos/org/members#graph-api-key-roles) of **Graph Admin** or **Persisted Query Publisher**. **Persisted Query Publisher** is a special role designed for use with the `rover persisted-queries publish` command; API keys with this role have no other access to your graph's data in GraphOS, and are appropriate for sharing with trusted third party client developers who should be allowed to publish operations to your graph's PQL but should not otherwise have access to your graph.

#### Test operations

You can send some test operations to test that you've successfully published your manifests:

First, start your GraphOS-connected router:

```bash
APOLLO_KEY="..." APOLLO_GRAPH_REF="..." ./router --config ./router.yaml

2023-05-11T15:32:30.684460Z  INFO Apollo Router v1.18.1 // (c) Apollo Graph, Inc. // Licensed as ELv2 (https://go.apollo.dev/elv2)
2023-05-11T15:32:30.684480Z  INFO Anonymous usage data is gathered to inform Apollo product development.  See https://go.apollo.dev/o/privacy for details.
2023-05-11T15:32:31.507085Z  INFO Health check endpoint exposed at http://127.0.0.1:8088/health
2023-05-11T15:32:31.507823Z  INFO GraphQL endpoint exposed at http://127.0.0.1:4000/ ðŸš€
```

Next, make a POST request with `curl`, like so:

```bash
curl http://localhost:4000 -X POST --json \
'{"extensions":{"persistedQuery":{"version":1,"sha256Hash":"dc67510fb4289672bea757e862d6b00e83db5d3cbbcfb15260601b6f29bb2b8f"}}}'
```

If your router's PQL includes an operation with an ID that matches the value of the provided `sha256Hash` property, it executes the corresponding operation and returns its result.
