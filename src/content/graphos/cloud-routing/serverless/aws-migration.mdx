---
title: Migrate Serverless routers to AWS
subtitle: Learn how to migrate from Fly.io to AWS cloud routing
description: Learn how to migrate from Fly.io to AWS cloud routing
---

<Note>

This page only applies to Serverless cloud routers created before May 21, 2024. Serverless cloud routers created on or after this date automatically run on AWS.

</Note>

Cloud Serverless is transitioning cloud providers from Fly.io to AWS to improve reliability and performance.
Serverless cloud routers created before May 21, 2024, run on Fly.io infrastructure, and you must migrate them in GraphOS Studio.

Cloud routers on Fly.io will continue to operate until July 2, 2024. After this date, any cloud routers on Fly.io will be permanently deleted.

## What's changing?

Running Serverless cloud routers on AWS offers improved reliability. On Fly.io, cloud routers supported up to 100 transactions per second (TPS) but the actual throughput was typically less. On AWS, Serverless cloud routers support larger schemas and offer a consistent ten requests per second (RPS) of throughput and up to 10 million requests per month for free.

Running on AWS also increases performance. On Fly.io, cloud routers were hosted in Chicago. On AWS, they will be hosted in `us-east-1`. This means faster performance, particularly for customers running subgraph servers on AWS, especially those running subgraphs near or in `us-east-1`.

With improved reliability and performance, Serverless can offer additional features of the Apollo Router, like [JWT authentication](/router/configuration/authn-jwt), [external coprocessors](/router/customizations/coprocessor), and more. Going forward, Serverless cloud routers will generally support all Apollo Router features when technically feasible.

If you require greater than 10 RPS throughput or hosting in a different AWS region, <TrackableLink href="https://www.apollographql.com/contact-sales?type=dedicated&referrer=docs" eventName="content_contact_cloud">upgrade to Dedicated</TrackableLink>.

### Inactivity period changes

Previously, Serverless cloud routers would sleep after two minutes of inactivity. Sleeping routers can't serve requests and must wake up to do so. With Serverless on AWS, cloud routers only sleep after seven days of inactivity.

With the extended inactivity threshold, cloud routers that haven't received traffic will automatically be deleted after thirty days. Deletion preserves a cloud router's associated variant's schema but deletes the underlying cloud router. Learn more in [Serverless router status](./#serverless-router-status).

### Change summary

|                                        | Fly.io Hosted                   | AWS Hosted                            |
| -------------------------------------- | ------------------------------- | ------------------------------------- |
| Throughput                             | up to 100 TPS                   | up to 10 RPS                          |
| Free operations <br/> (no change)      | up to 10M requests/month        | up to 10M requests/month              |
| Hosting location                       | `ord` <br/> (Chicago, Illinois) | `us-east-1` <br/> (Northern Virginia) |
| Inactivity period <br/>before sleep    | Two minutes                     | Seven days                            |
| Inactivity period <br/>before deletion | Sixty days                      | Thirty days                           |

## Who needs to migrate?

Only GraphOS Serverless plan customers using a cloud router running on Fly.io need to migrate. You can check if your cloud router runs on Fly.io by looking at the region under the **Cloud Router Details** on the graph's overview page. If the region is `ord - Chicago`, you need to migrate.

[To-do: add screenshot of migration banner]

<Tip>

Don't hesitate to contact [cloud@apollographql.com](mailto:cloud@apollographql.com) with any migration questions or concerns.

</Tip>

## How to migrate

Migrating to AWS entails creating a new variant or graph in GraphOS Studio. Once you create a new variant or graph, you receive a new graph ref and endpoint URL to redirect client traffic to. There is no way to reuse your existing graph ref.

<Caution>

Only delete your existing cloud router after you've created your new cloud router. To migrate, you need a copy of your schema and subgraph URLs.

</Caution>

<!-- vale Apollo.Headings = NO -->

### Step 1. Create a new graph

To get started, create a new graph or variant in GraphOS Studio. You need at least one subgraph during this process. See the [getting started](/graphos/quickstart/cloud/#from-an-existing-account) for details on creating a new graph.

Creating a new graph or variant generates a new graph ref and endpoint URL. You'll need to update wherever these values are used, including in your Rover commands and client codebase.

### Step 2. Add subgraphs

If you have multiple subgraphs, [add each subgraph](/graphos/quickstart/next-steps/#add-another-subgraph) to your new variant.

### Step 3. Setup router configuration

Copy and paste your old router's configuration into your new one. You can access a Serverless cloud router configuration from **Settings > Cloud Router > Router configuration YAML** in GraphOS Studio.

<img
  className="screenshot"
  alt="Configuring the routing for your cloud supergraph in GraphOS Studio"
  src="../../img/cloud-routing/configuration-main.jpg"
  width="700"
/>

Router configuration defines important values like CORS policies and header propagation.

<Note>

If you have [secrets](../configuration/#managing-secrets) in your old cloud router configuration, you must also set them in your new configuration. Secrets can't be read once saved.

</Note>

### Step 4. Test

Once you've added all your subgraphs and set up your cloud router configuration, try running a few sample operations from [Explorer](../../explorer/).
You may need to enable [subgraph errors](/graphos/cloud-routing/configuration#subgraph-error-inclusion) to troubleshoot if your operations don't execute.

In certain circumstances, Serverless on AWS offers less throughput than Fly.io, so you should simulate production traffic before going live. If you exceed throughput limits, your clients will receive 429 errors.

<Note>

It isn't possible to increase throughput on Serverless. Consider using [Cloud Dedicated](../dedicated/).

</Note>

### Step 5. Go live

To go live, update the endpoint URL your clients use to query your supergraph. You can see your new router's endpoint from the **Overview** page of your variant.

<img
  className="screenshot"
  alt="Variant overview page in GraphOS Studio"
  src="../../img/cloud-routing/graph-overview.jpg"
  width="700"
/>

<!-- vale Apollo.Headings = YES -->
